<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fund Dashboard Demo</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<style>
:root {
  --primary:#FF9400;
  --btn:#1D3354;
  --bg:#f6f7f9;
}
* { box-sizing:border-box; }
body { margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto; background:var(--bg); }
header { padding:12px; background:var(--primary); color:#fff; text-align:center; font-weight:600; }
.container { padding:12px 12px 86px; }

/* filters */
.filters { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:12px; }
.filters select, .filters input { padding:6px; border-radius:6px; border:1px solid #ddd; font-size:12px; width:100%; }

/* table */
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; }
th, td { padding:10px 8px; font-size:12px; border-bottom:1px solid #eee; text-align:left; white-space:nowrap; }
th { background:#fafafa; font-weight:600; cursor:pointer; }

.sort-icon {
  display:inline-flex;
  flex-direction:column;
  margin-left:4px;
  font-size:8px;
  line-height:8px;
  color:#bbb;
}
.sort-icon.active { color:#333; }

.group-row td {
  background:#f0f0f0;
  font-weight:600;
  font-size:13px;
}

.fund-name {
  max-width:160px;
  overflow:hidden;
  text-overflow:ellipsis;
}

.risk-1 { background:#e6f4ea; }
.risk-2 { background:#dff0e4; }
.risk-3 { background:#fff7e6; }
.risk-4 { background:#ffe8c2; }
.risk-5 { background:#ffd6a5; }
.risk-6 { background:#ffb703; }
.risk-7 { background:#ff8c69; }

/* pagination */
.pagination { display:flex; justify-content:center; gap:6px; margin:14px 0; align-items:center; }
.pagination button { padding:4px 8px; border-radius:6px; border:1px solid #ddd; background:#fff; font-size:12px; }
.pagination input { width:42px; text-align:center; font-size:12px; }

/* fixed bar */
.fixed-bar {
  position:fixed;
  left:0; right:0; bottom:0;
  padding:12px;
  background:#fff;
  border-top:1px solid #eee;
}
.fixed-bar button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:var(--btn);
  color:#fff;
  font-size:15px;
  font-weight:600;
}

/* chart page */
.hidden { display:none; }
.back { font-size:20px; margin-bottom:6px; cursor:pointer; }
#chart { width:100%; height:260px; background:#fff; border-radius:12px; }
</style>
</head>
<body>
<header>Fund Dashboard</header>

<!-- LIST PAGE -->
<div class="container" id="listPage">
  <div class="filters">
    <select id="trusteeFilter">
      <option value="">All Trustees</option>
      <option value="AIA">AIA</option>
      <option value="HSBC">HSBC</option>
    </select>
    <select id="riskFilter">
      <option value="">All Risk</option>
      <option value="1">1</option><option value="2">2</option><option value="3">3</option>
      <option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option>
    </select>
    <input type="number" id="minReturn" placeholder="1Y % Min" />
    <input type="number" id="maxReturn" placeholder="1Y % Max" />
  </div>

  <table>
    <thead>
      <tr>
        <th></th>
        <th data-sort="name">Fund Name <span class="sort-icon"><span>▲</span><span>▼</span></span></th>
        <th data-sort="r3m">3M <span class="sort-icon"><span>▲</span><span>▼</span></span></th>
        <th data-sort="r1y">1Y <span class="sort-icon"><span>▲</span><span>▼</span></span></th>
        <th data-sort="fee">Fee <span class="sort-icon"><span>▲</span><span>▼</span></span></th>
        <th data-sort="risk">Risk <span class="sort-icon"><span>▲</span><span>▼</span></span></th>
      </tr>
    </thead>
    <tbody id="fundBody"></tbody>
  </table>

  <div class="pagination" id="pagination"></div>
</div>

<!-- CHART PAGE -->
<div class="container hidden" id="chartPage">
  <div class="back" onclick="goBack()">&lt;</div>
  <div id="chart"></div>
</div>

<div class="fixed-bar">
  <button onclick="goCompare()">Compare Selected Funds</button>
</div>

<script>
/* ---------- mock backend data ---------- */
const allFunds = [];
const trustees = ['AIA','HSBC'];
const schemas = ['Fund I','Fund II','Fund III'];
let id = 1;

trustees.forEach(t => {
  schemas.forEach(s => {
    const count = Math.floor(Math.random()*3)+2;
    for(let i=0;i<count;i++){
      allFunds.push({
        id: id++,
        trustee: t,
        schema: s,
        group: `${t} - ${s}`,
        name: `${t} Growth Fund ${id}`,
        r3m: (Math.random()*5 - 2).toFixed(2),
        r1y: (Math.random()*20 - 5).toFixed(2),
        fee: (0.6+Math.random()).toFixed(2),
        risk: Math.floor(Math.random()*7)+1
      });
    }
  });
});

/* ---------- state ---------- */
let page = 1;
const pageSize = 20;
const selected = new Set();
let sortKey = '';
let sortDir = 1;

/* ---------- filtering + sorting ---------- */
function getFiltered(){
  let data = allFunds.filter(f => {
    if (trusteeFilter.value && f.trustee !== trusteeFilter.value) return false;
    if (riskFilter.value && String(f.risk) !== riskFilter.value) return false;
    if (minReturn.value && Number(f.r1y) < minReturn.value) return false;
    if (maxReturn.value && Number(f.r1y) > maxReturn.value) return false;
    return true;
  });

  if (sortKey) {
    data.sort((a,b) => {
      let v1 = a[sortKey];
      let v2 = b[sortKey];
      v1 = Number(v1);
      v2 = Number(v2);
      if (v1 < v2) return -1 * sortDir;
      if (v1 > v2) return 1 * sortDir;
      return 0;
    });
  }
  return data;
}

/* ---------- render table ---------- */
function renderTable(){
  const data = getFiltered();
  const tbody = document.getElementById('fundBody');
  tbody.innerHTML = '';

  const start = (page-1)*pageSize;
  const pageData = data.slice(start, start+pageSize);

  let currentGroup = '';
  pageData.forEach(f => {
    if (f.group !== currentGroup) {
      currentGroup = f.group;
      const gr = document.createElement('tr');
      gr.className = 'group-row';
      gr.innerHTML = `<td colspan="6">${currentGroup}</td>`;
      tbody.appendChild(gr);
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="checkbox" ${selected.has(f.id)?'checked':''}></td>
      <td class="fund-name">${f.name}</td>
      <td>${f.r3m}%</td>
      <td>${f.r1y}%</td>
      <td>${f.fee}%</td>
      <td class="risk-${f.risk}">${f.risk}</td>
    `;
    tr.querySelector('input').onchange = e => {
      e.target.checked ? selected.add(f.id) : selected.delete(f.id);
    };
    tbody.appendChild(tr);
  });

  renderPagination(data.length);
}

function renderPagination(total){
  const pages = Math.ceil(total / pageSize) || 1;
  const p = document.getElementById('pagination');
  p.innerHTML = '';

  const prev = document.createElement('button');
  prev.textContent = '<';
  prev.onclick = () => { if(page>1){ page--; renderTable(); } };
  p.appendChild(prev);

  const cur = document.createElement('button');
  cur.textContent = page;
  cur.style.background = '#ddd';
  p.appendChild(cur);

  const input = document.createElement('input');
  input.type = 'number';
  input.min = 1;
  input.max = pages;
  input.value = page;
  input.onchange = () => {
    let v = Number(input.value);
    if (v>=1 && v<=pages) { page=v; renderTable(); }
  };
  p.appendChild(input);

  const next = document.createElement('button');
  next.textContent = '>';
  next.onclick = () => { if(page<pages){ page++; renderTable(); } };
  p.appendChild(next);

  const totalSpan = document.createElement('span');
  totalSpan.textContent = pages;
  totalSpan.style.fontSize='12px';
  totalSpan.style.marginLeft='4px';
  p.appendChild(totalSpan);
}

trusteeFilter.onchange = riskFilter.onchange = minReturn.oninput = maxReturn.oninput = () => {
  page = 1; renderTable();
};

// sort handlers
Array.from(document.querySelectorAll('th[data-sort]')).forEach(th => {
  th.addEventListener('click', () => {
    const key = th.dataset.sort;
    if (sortKey === key) {
      sortDir = -sortDir;
    } else {
      sortKey = key;
      sortDir = 1;
    }
    document.querySelectorAll('.sort-icon').forEach(i=>i.classList.remove('active'));
    th.querySelector('.sort-icon').classList.add('active');
    page = 1;
    renderTable();
  });
});

renderTable();

/* ---------- compare ---------- */
function goCompare(){
  if (selected.size === 0) return alert('Select at least one fund');
  listPage.classList.add('hidden');
  chartPage.classList.remove('hidden');
  drawChart();
}

function goBack(){
  chartPage.classList.add('hidden');
  listPage.classList.remove('hidden');
}

function drawChart(){
  const chart = echarts.init(document.getElementById('chart'));
  const series = Array.from(selected).map(id => {
    const f = allFunds.find(x => x.id === id);
    return {
      name: f.name,
      type: 'line',
      data: Array.from({length:8}, (_,i)=>(Math.random()*f.r1y).toFixed(2))
    };
  });

  chart.setOption({
    tooltip:{ trigger:'axis' },
    legend:{ top:10, left:'center' },
    grid:{ left:40, right:20, top:50, bottom:30 },
    xAxis:{ type:'category', data:['Dec','Jan','Feb','Mar','Apr','May','Jun','Jul'] },
    yAxis:{ type:'value', axisLabel:{ formatter:'{value}%' } },
    series
  });
}
</script>
</body>
</html>
